<head>
<title>HepMC Reference Documentation </title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head>
<body bgcolor="#FFFFFF">

<!-------------------------------- Header ---------------------------->
<table width="100%" border="1" height="70" cellpadding="10">
  <tr bgcolor="#FFFFCC"> 
    <td width="16%" height="64" valign="middle" align="center" bgcolor="#FFFFCC">
     <!-- #BeginLibraryItem" -->
      <img src="http://spi.cern.ch//LCG logo.jpg" width="61" height="61">
     <!-- #EndLibraryItem --> 
    </td>
    <td width="84%" height="64" valign="middle" align="center">
	<h1>HepMC Reference Documentation</h1> 
	<a href=http://lcgapp.cern.ch/project/simu/HepMC/>HepMC</a>
    </td> 
  </tr>
</table>
<p>
<!-- Generated by Doxygen 1.5.1-3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
  </ul>
</div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="dir_2f7e53fbf59743acafe0a1c443dedb88.html">fio</a></div>
<h1>IO_HERWIG.cc</h1><a href="IO__HERWIG_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">// Matt.Dobbs@Cern.CH, October 2002</span>
<a name="l00003"></a>00003 <span class="comment">// Herwig 6.400 IO class</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="preprocessor">#include "<a class="code" href="IO__HERWIG_8h.html">HepMC/IO_HERWIG.h</a>"</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include "<a class="code" href="GenEvent_8h.html">HepMC/GenEvent.h</a>"</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;cstdio&gt;</span>       <span class="comment">// needed for formatted output using sprintf </span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="keyword">namespace </span>HepMC {
<a name="l00011"></a>00011 
<a name="l00012"></a><a class="code" href="classHepMC_1_1IO__HERWIG.html#b301cc044feaf12ebbd0f3e3d2bd170a">00012</a>     <a class="code" href="classHepMC_1_1IO__HERWIG.html#b301cc044feaf12ebbd0f3e3d2bd170a">IO_HERWIG::IO_HERWIG</a>() : m_trust_mothers_before_daughters(false),
<a name="l00013"></a>00013                              m_trust_both_mothers_and_daughters(true),
<a name="l00014"></a>00014                              m_print_inconsistency_errors(true),
<a name="l00015"></a>00015                              m_no_gaps_in_barcodes(true),
<a name="l00016"></a>00016                              m_herwig_to_pdg_id(100,0)
<a name="l00017"></a>00017     {
<a name="l00018"></a>00018         <span class="comment">// These arrays are copied from Lynn Garren's stdhep 5.01.</span>
<a name="l00019"></a>00019         <span class="comment">//   see http://www-pat.fnal.gov/stdhep.html</span>
<a name="l00020"></a>00020         <span class="comment">// Translation from HERWIG particle ID's to PDG particle ID's.</span>
<a name="l00021"></a>00021         m_herwig_to_pdg_id[1] =1; 
<a name="l00022"></a>00022         m_herwig_to_pdg_id[2] =2;
<a name="l00023"></a>00023         m_herwig_to_pdg_id[3] =3;
<a name="l00024"></a>00024         m_herwig_to_pdg_id[4] =4;
<a name="l00025"></a>00025         m_herwig_to_pdg_id[5] =5;
<a name="l00026"></a>00026         m_herwig_to_pdg_id[6] =6;
<a name="l00027"></a>00027         m_herwig_to_pdg_id[7] =7;
<a name="l00028"></a>00028         m_herwig_to_pdg_id[8] =8;
<a name="l00029"></a>00029        
<a name="l00030"></a>00030         m_herwig_to_pdg_id[11] =11;
<a name="l00031"></a>00031         m_herwig_to_pdg_id[12] =12;
<a name="l00032"></a>00032         m_herwig_to_pdg_id[13] =13;
<a name="l00033"></a>00033         m_herwig_to_pdg_id[14] =14;
<a name="l00034"></a>00034         m_herwig_to_pdg_id[15] =15;
<a name="l00035"></a>00035         m_herwig_to_pdg_id[16] =16;
<a name="l00036"></a>00036        
<a name="l00037"></a>00037         m_herwig_to_pdg_id[21] =21;
<a name="l00038"></a>00038         m_herwig_to_pdg_id[22] =22;
<a name="l00039"></a>00039         m_herwig_to_pdg_id[23] =23;
<a name="l00040"></a>00040         m_herwig_to_pdg_id[24] =24;
<a name="l00041"></a>00041         m_herwig_to_pdg_id[25] =25;
<a name="l00042"></a>00042         m_herwig_to_pdg_id[26] =51; <span class="comment">// &lt;--</span>
<a name="l00043"></a>00043        
<a name="l00044"></a>00044         m_herwig_to_pdg_id[32] =32;
<a name="l00045"></a>00045         m_herwig_to_pdg_id[35] =35;
<a name="l00046"></a>00046         m_herwig_to_pdg_id[36] =36;
<a name="l00047"></a>00047         m_herwig_to_pdg_id[37] =37;
<a name="l00048"></a>00048         m_herwig_to_pdg_id[39] =39;
<a name="l00049"></a>00049        
<a name="l00050"></a>00050         m_herwig_to_pdg_id[81] =81;
<a name="l00051"></a>00051         m_herwig_to_pdg_id[82] =82;
<a name="l00052"></a>00052         m_herwig_to_pdg_id[83] =83;
<a name="l00053"></a>00053         m_herwig_to_pdg_id[84] =84;
<a name="l00054"></a>00054         m_herwig_to_pdg_id[85] =85;
<a name="l00055"></a>00055         m_herwig_to_pdg_id[86] =86;
<a name="l00056"></a>00056         m_herwig_to_pdg_id[87] =87;
<a name="l00057"></a>00057         m_herwig_to_pdg_id[88] =88;
<a name="l00058"></a>00058         m_herwig_to_pdg_id[89] =89;
<a name="l00059"></a>00059         m_herwig_to_pdg_id[90] =90;
<a name="l00060"></a>00060        
<a name="l00061"></a>00061         m_herwig_to_pdg_id[91] =91;
<a name="l00062"></a>00062         m_herwig_to_pdg_id[92] =92;
<a name="l00063"></a>00063         m_herwig_to_pdg_id[93] =93;
<a name="l00064"></a>00064         m_herwig_to_pdg_id[94] =94;
<a name="l00065"></a>00065         m_herwig_to_pdg_id[95] =95;
<a name="l00066"></a>00066         m_herwig_to_pdg_id[96] =96;
<a name="l00067"></a>00067         m_herwig_to_pdg_id[97] =97;
<a name="l00068"></a>00068         m_herwig_to_pdg_id[98] =9920022; <span class="comment">// &lt;--</span>
<a name="l00069"></a>00069         m_herwig_to_pdg_id[99] =9922212; <span class="comment">// &lt;--</span>
<a name="l00070"></a>00070 
<a name="l00071"></a>00071         <span class="comment">// These particle ID's have no antiparticle, so aren't allowed.</span>
<a name="l00072"></a>00072         m_no_antiparticles.insert(-21);
<a name="l00073"></a>00073         m_no_antiparticles.insert(-22);
<a name="l00074"></a>00074         m_no_antiparticles.insert(-23);
<a name="l00075"></a>00075         m_no_antiparticles.insert(-25);
<a name="l00076"></a>00076         m_no_antiparticles.insert(-51);
<a name="l00077"></a>00077         m_no_antiparticles.insert(-35);
<a name="l00078"></a>00078         m_no_antiparticles.insert(-36);
<a name="l00079"></a>00079     }
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="classHepMC_1_1IO__HERWIG.html#99bfa883ae364b1154c8cc7dc7d311a0">00081</a>     IO_HERWIG::~IO_HERWIG(){}
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="classHepMC_1_1IO__HERWIG.html#ab6853a2888f6e2f628039b9079fe120">00083</a>     <span class="keywordtype">void</span> <a class="code" href="classHepMC_1_1IO__HERWIG.html#ab6853a2888f6e2f628039b9079fe120" title="write to ostr">IO_HERWIG::print</a>( std::ostream&amp; ostr )<span class="keyword"> const </span>{ 
<a name="l00084"></a>00084         ostr &lt;&lt; <span class="stringliteral">"IO_HERWIG: reads an event from the FORTRAN Herwig HEPEVT "</span>
<a name="l00085"></a>00085              &lt;&lt; <span class="stringliteral">"common block. \n"</span> 
<a name="l00086"></a>00086              &lt;&lt; <span class="stringliteral">" trust_mothers_before_daughters = "</span> 
<a name="l00087"></a>00087              &lt;&lt; m_trust_mothers_before_daughters
<a name="l00088"></a>00088              &lt;&lt; <span class="stringliteral">" trust_both_mothers_and_daughters = "</span>
<a name="l00089"></a>00089              &lt;&lt; m_trust_both_mothers_and_daughters
<a name="l00090"></a>00090              &lt;&lt; <span class="stringliteral">" print_inconsistency_errors = "</span> 
<a name="l00091"></a>00091              &lt;&lt; m_print_inconsistency_errors &lt;&lt; std::endl;
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="classHepMC_1_1IO__HERWIG.html#7a49968897062f0e977053bcdf176e17">00094</a>     <span class="keywordtype">bool</span> <a class="code" href="classHepMC_1_1IO__HERWIG.html#7a49968897062f0e977053bcdf176e17" title="get the next event">IO_HERWIG::fill_next_event</a>( <a class="code" href="classHepMC_1_1GenEvent.html" title="The GenEvent class is the core of HepMC.">GenEvent</a>* evt ) {
<a name="l00097"></a>00097         <span class="comment">//</span>
<a name="l00098"></a>00098         <span class="comment">// 0. Test that evt pointer is not null and set event number</span>
<a name="l00099"></a>00099         <span class="keywordflow">if</span> ( !evt ) {
<a name="l00100"></a>00100             std::cerr 
<a name="l00101"></a>00101                 &lt;&lt; <span class="stringliteral">"IO_HERWIG::fill_next_event error - passed null event."</span> 
<a name="l00102"></a>00102                 &lt;&lt; std::endl;
<a name="l00103"></a>00103             <span class="keywordflow">return</span> 0;
<a name="l00104"></a>00104         }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         <span class="comment">// 1. First we have to fix the HEPEVT input, which is all mucked up for</span>
<a name="l00107"></a>00107         <span class="comment">//    herwig.</span>
<a name="l00108"></a>00108         <a class="code" href="classHepMC_1_1IO__HERWIG.html#40fc149a9760dc7b03b08402f16b7929" title="make the HERWIG HEPEVT common block look like the standard">repair_hepevt</a>();
<a name="l00109"></a>00109 
<a name="l00110"></a>00110         evt-&gt;<a class="code" href="classHepMC_1_1GenEvent.html#84278cf4e4ce807d60f99d9288c1ad8e" title="set event number">set_event_number</a>( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#75fe312f2cfb59db1b8dd7796be78dea" title="event number">HEPEVT_Wrapper::event_number</a>() );
<a name="l00111"></a>00111         <span class="comment">//</span>
<a name="l00112"></a>00112         <span class="comment">// 2. create a particle instance for each HEPEVT entry and fill a map</span>
<a name="l00113"></a>00113         <span class="comment">//    create a vector which maps from the HEPEVT particle index to the </span>
<a name="l00114"></a>00114         <span class="comment">//    GenParticle address</span>
<a name="l00115"></a>00115         <span class="comment">//    (+1 in size accounts for hepevt_particle[0] which is unfilled)</span>
<a name="l00116"></a>00116         std::vector&lt;GenParticle*&gt; hepevt_particle( 
<a name="l00117"></a>00117                                         <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#69b67d3c95321dc6130996e086480e86" title="num entries in current evt">HEPEVT_Wrapper::number_entries</a>()+1 );
<a name="l00118"></a>00118         hepevt_particle[0] = 0;
<a name="l00119"></a>00119         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i1 = 1; i1 &lt;= <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#69b67d3c95321dc6130996e086480e86" title="num entries in current evt">HEPEVT_Wrapper::number_entries</a>(); ++i1 ) {
<a name="l00120"></a>00120             hepevt_particle[i1] = <a class="code" href="classHepMC_1_1IO__HERWIG.html#2afff99e4948621126d1211272b3fb02" title="make a particle">build_particle</a>(i1);
<a name="l00121"></a>00121         }
<a name="l00122"></a>00122         std::set&lt;GenVertex*&gt; new_vertices;
<a name="l00123"></a>00123         <span class="comment">//</span>
<a name="l00124"></a>00124         <span class="comment">// Here we assume that the first two particles in the list </span>
<a name="l00125"></a>00125         <span class="comment">// are the incoming beam particles.</span>
<a name="l00126"></a>00126         evt-&gt;<a class="code" href="classHepMC_1_1GenEvent.html#fc5841ea5b2f05df61a36579c428769e" title="set incoming beam particles">set_beam_particles</a>( hepevt_particle[1], hepevt_particle[2] );
<a name="l00127"></a>00127         <span class="comment">//</span>
<a name="l00128"></a>00128         <span class="comment">// 3. We need to take special care with the hard process</span>
<a name="l00129"></a>00129         <span class="comment">// vertex.  The problem we are trying to avoid is when the</span>
<a name="l00130"></a>00130         <span class="comment">// partons entering the hard process also have daughters from</span>
<a name="l00131"></a>00131         <span class="comment">// the parton shower. When this happens, each one can get its</span>
<a name="l00132"></a>00132         <span class="comment">// own decay vertex, making it difficult to join them</span>
<a name="l00133"></a>00133         <span class="comment">// later. We handle it by joining them together first, then</span>
<a name="l00134"></a>00134         <span class="comment">// the other daughters get added on later.</span>
<a name="l00135"></a>00135         <span class="comment">// Find the partons entering the hard vertex (status codes 121, 122).</span>
<a name="l00136"></a>00136         <span class="keywordtype">int</span> index_121 = 0;
<a name="l00137"></a>00137         <span class="keywordtype">int</span> index_122 = 0;
<a name="l00138"></a>00138         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 1; i &lt;=<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#69b67d3c95321dc6130996e086480e86" title="num entries in current evt">HEPEVT_Wrapper::number_entries</a>(); i++ ) {
<a name="l00139"></a>00139             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(i)==121 ) index_121=i;
<a name="l00140"></a>00140             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(i)==122 ) index_122=i;
<a name="l00141"></a>00141             <span class="keywordflow">if</span> ( index_121!=0 &amp;&amp; index_122!=0 ) <span class="keywordflow">break</span>;
<a name="l00142"></a>00142         }
<a name="l00143"></a>00143         <span class="keywordflow">if</span> ( index_121 &amp;&amp; index_122 ) {
<a name="l00144"></a>00144             <a class="code" href="classHepMC_1_1GenVertex.html" title="GenVertex contains information about decay vertices.">GenVertex</a>* hard_vtx = <span class="keyword">new</span> <a class="code" href="classHepMC_1_1GenVertex.html" title="GenVertex contains information about decay vertices.">GenVertex</a>();
<a name="l00145"></a>00145             hard_vtx-&gt;<a class="code" href="classHepMC_1_1GenVertex.html#62a329fbb235284e70c24e1bf7ba49e8" title="add incoming particle">add_particle_in</a>( hepevt_particle[index_121] );
<a name="l00146"></a>00146             hard_vtx-&gt;<a class="code" href="classHepMC_1_1GenVertex.html#62a329fbb235284e70c24e1bf7ba49e8" title="add incoming particle">add_particle_in</a>( hepevt_particle[index_122] );
<a name="l00147"></a>00147             <span class="comment">// evt-&gt;add_vertex( hard_vtx ); // not necessary, its done in </span>
<a name="l00148"></a>00148                                             <span class="comment">// set_signal_process_vertex</span>
<a name="l00149"></a>00149             evt-&gt;<a class="code" href="classHepMC_1_1GenEvent.html#32f00631c76556295ab3963062436abb" title="set pointer to the vertex containing the signal process">set_signal_process_vertex</a>( hard_vtx );
<a name="l00150"></a>00150         }
<a name="l00151"></a>00151         <span class="comment">//</span>
<a name="l00152"></a>00152         <span class="comment">// 4. loop over HEPEVT particles AGAIN, this time creating vertices</span>
<a name="l00153"></a>00153         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 1; i &lt;= <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#69b67d3c95321dc6130996e086480e86" title="num entries in current evt">HEPEVT_Wrapper::number_entries</a>(); ++i ) {
<a name="l00154"></a>00154             <span class="comment">// We go through and build EITHER the production or decay </span>
<a name="l00155"></a>00155             <span class="comment">// vertex for each entry in hepevt, depending on the switch</span>
<a name="l00156"></a>00156             <span class="comment">// m_trust_mothers_before_daughters (new 2001-02-28)</span>
<a name="l00157"></a>00157             <span class="comment">// Note: since the HEPEVT pointers are bi-directional, it is</span>
<a name="l00159"></a>00159 <span class="comment"></span>            <span class="comment">//</span>
<a name="l00160"></a>00160             <span class="comment">// 3. Build the production_vertex (if necessary)</span>
<a name="l00161"></a>00161             <span class="keywordflow">if</span> ( m_trust_mothers_before_daughters || 
<a name="l00162"></a>00162                  m_trust_both_mothers_and_daughters ) {
<a name="l00163"></a>00163                 <a class="code" href="classHepMC_1_1IO__HERWIG.html#6de881de5bbbf579695522af451814a7" title="make a production vertex">build_production_vertex</a>( i, hepevt_particle, evt );
<a name="l00164"></a>00164             }
<a name="l00165"></a>00165             <span class="comment">//</span>
<a name="l00166"></a>00166             <span class="comment">// 4. Build the end_vertex (if necessary) </span>
<a name="l00167"></a>00167             <span class="comment">//    Identical steps as for production vertex</span>
<a name="l00168"></a>00168             <span class="keywordflow">if</span> ( !m_trust_mothers_before_daughters || 
<a name="l00169"></a>00169                  m_trust_both_mothers_and_daughters ) {
<a name="l00170"></a>00170                 <a class="code" href="classHepMC_1_1IO__HERWIG.html#8077ede98c4040631f28424c6624a50b" title="make a decay vertex">build_end_vertex</a>( i, hepevt_particle, evt );
<a name="l00171"></a>00171             }
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173         <span class="comment">// 5.             01.02.2000</span>
<a name="l00174"></a>00174         <span class="comment">// handle the case of particles in HEPEVT which come from nowhere -</span>
<a name="l00175"></a>00175         <span class="comment">//  i.e. particles without mothers or daughters.</span>
<a name="l00176"></a>00176         <span class="comment">//  These particles need to be attached to a vertex, or else they</span>
<a name="l00177"></a>00177         <span class="comment">//  will never become part of the event. check for this situation.</span>
<a name="l00178"></a>00178         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i3 = 1; i3 &lt;= <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#69b67d3c95321dc6130996e086480e86" title="num entries in current evt">HEPEVT_Wrapper::number_entries</a>(); ++i3 ) {
<a name="l00179"></a>00179             <span class="comment">// Herwig also has some non-physical entries in HEPEVT</span>
<a name="l00180"></a>00180             <span class="comment">// like CMS, HARD, and CONE. These are flagged by</span>
<a name="l00181"></a>00181             <span class="comment">// repair_hepevt by making their status and id zero. We</span>
<a name="l00182"></a>00182             <span class="comment">// delete those particles here.</span>
<a name="l00183"></a>00183             <span class="keywordflow">if</span> ( hepevt_particle[i3] &amp;&amp; !hepevt_particle[i3]-&gt;parent_event()
<a name="l00184"></a>00184                  &amp;&amp; !hepevt_particle[i3]-&gt;pdg_id()
<a name="l00185"></a>00185                  &amp;&amp; !hepevt_particle[i3]-&gt;status() ) {
<a name="l00186"></a>00186                 <span class="comment">//std::cout &lt;&lt; "IO_HERWIG::fill_next_event is deleting null "</span>
<a name="l00187"></a>00187                 <span class="comment">//        &lt;&lt; "particle" &lt;&lt; std::endl;</span>
<a name="l00188"></a>00188                 <span class="comment">//hepevt_particle[i3]-&gt;print();</span>
<a name="l00189"></a>00189                 <span class="keyword">delete</span> hepevt_particle[i3];
<a name="l00190"></a>00190             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( hepevt_particle[i3] &amp;&amp; 
<a name="l00191"></a>00191                         !hepevt_particle[i3]-&gt;end_vertex() &amp;&amp; 
<a name="l00192"></a>00192                         !hepevt_particle[i3]-&gt;production_vertex() ) {
<a name="l00193"></a>00193                 <a class="code" href="classHepMC_1_1GenVertex.html" title="GenVertex contains information about decay vertices.">GenVertex</a>* prod_vtx = <span class="keyword">new</span> <a class="code" href="classHepMC_1_1GenVertex.html" title="GenVertex contains information about decay vertices.">GenVertex</a>();
<a name="l00194"></a>00194                 prod_vtx-&gt;<a class="code" href="classHepMC_1_1GenVertex.html#eba71fdc7561e80fbbea2f60ac9358e7" title="add outgoing particle">add_particle_out</a>( hepevt_particle[i3] );
<a name="l00195"></a>00195                 evt-&gt;<a class="code" href="classHepMC_1_1GenEvent.html#351fd8c688bb1791877a56a956c8b005" title="adds to evt and adopts">add_vertex</a>( prod_vtx );
<a name="l00196"></a>00196             }
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200 
<a name="l00201"></a><a class="code" href="classHepMC_1_1IO__HERWIG.html#6de881de5bbbf579695522af451814a7">00201</a>     <span class="keywordtype">void</span> <a class="code" href="classHepMC_1_1IO__HERWIG.html#6de881de5bbbf579695522af451814a7" title="make a production vertex">IO_HERWIG::build_production_vertex</a>(<span class="keywordtype">int</span> i, 
<a name="l00202"></a>00202                                             std::vector&lt;GenParticle*&gt;&amp; 
<a name="l00203"></a>00203                                             hepevt_particle,
<a name="l00204"></a>00204                                             <a class="code" href="classHepMC_1_1GenEvent.html" title="The GenEvent class is the core of HepMC.">GenEvent</a>* evt ) {
<a name="l00208"></a>00208         <a class="code" href="classHepMC_1_1GenParticle.html" title="The GenParticle class contains information about generated particles.">GenParticle</a>* <a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a> = hepevt_particle[i];
<a name="l00209"></a>00209         <span class="comment">// a. search to see if a production vertex already exists</span>
<a name="l00210"></a>00210         <span class="keywordtype">int</span> mother = <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(i);
<a name="l00211"></a>00211         <a class="code" href="classHepMC_1_1GenVertex.html" title="GenVertex contains information about decay vertices.">GenVertex</a>* prod_vtx = <a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a>-&gt;production_vertex();
<a name="l00212"></a>00212         <span class="keywordflow">while</span> ( !prod_vtx &amp;&amp; mother &gt; 0 ) {
<a name="l00213"></a>00213             prod_vtx = hepevt_particle[mother]-&gt;end_vertex();
<a name="l00214"></a>00214             <span class="keywordflow">if</span> ( prod_vtx ) prod_vtx-&gt;<a class="code" href="classHepMC_1_1GenVertex.html#eba71fdc7561e80fbbea2f60ac9358e7" title="add outgoing particle">add_particle_out</a>( <a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a> );
<a name="l00215"></a>00215             <span class="comment">// increment mother for next iteration</span>
<a name="l00216"></a>00216             <span class="keywordflow">if</span> ( ++mother &gt; <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#bffc1f6aa474d1a7f4822142cb82df41" title="index of last mother">HEPEVT_Wrapper::last_parent</a>(i) ) mother = 0;
<a name="l00217"></a>00217         }
<a name="l00218"></a>00218         <span class="comment">// b. if no suitable production vertex exists - and the particle</span>
<a name="l00219"></a>00219         <span class="comment">// has atleast one mother or position information to store - </span>
<a name="l00220"></a>00220         <span class="comment">// make one</span>
<a name="l00221"></a>00221         <a class="code" href="classHepMC_1_1FourVector.html" title="FourVector is a simple representation of a physics 4 vector.">FourVector</a> prod_pos( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#5e6b99a24d23c6a9ee12eddb3ee6b3f2" title="X Production vertex.">HEPEVT_Wrapper::x</a>(i), <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#9ddff6e0faa83005830621428c01eb25" title="Y Production vertex.">HEPEVT_Wrapper::y</a>(i), 
<a name="l00222"></a>00222                                    <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#68b9f32b2c5cefda476a3b05bbe831fd" title="Z Production vertex.">HEPEVT_Wrapper::z</a>(i), <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#b302ab96378802b5d3549618ed2f063b" title="production time">HEPEVT_Wrapper::t</a>(i) 
<a name="l00223"></a>00223                                  ); 
<a name="l00224"></a>00224         <span class="keywordflow">if</span> ( !prod_vtx &amp;&amp; (<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#b3c2eba5e08d497d5397a1df76347309" title="number of parents">HEPEVT_Wrapper::number_parents</a>(i)&gt;0 
<a name="l00225"></a>00225                            || prod_pos!=<a class="code" href="classHepMC_1_1FourVector.html" title="FourVector is a simple representation of a physics 4 vector.">FourVector</a>(0,0,0,0)) )
<a name="l00226"></a>00226         {
<a name="l00227"></a>00227             prod_vtx = <span class="keyword">new</span> <a class="code" href="classHepMC_1_1GenVertex.html" title="GenVertex contains information about decay vertices.">GenVertex</a>();
<a name="l00228"></a>00228             prod_vtx-&gt;<a class="code" href="classHepMC_1_1GenVertex.html#eba71fdc7561e80fbbea2f60ac9358e7" title="add outgoing particle">add_particle_out</a>( <a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a> );
<a name="l00229"></a>00229             evt-&gt;<a class="code" href="classHepMC_1_1GenEvent.html#351fd8c688bb1791877a56a956c8b005" title="adds to evt and adopts">add_vertex</a>( prod_vtx ); 
<a name="l00230"></a>00230         }
<a name="l00231"></a>00231         <span class="comment">// c. if prod_vtx doesn't already have position specified, fill it</span>
<a name="l00232"></a>00232         <span class="keywordflow">if</span> ( prod_vtx &amp;&amp; prod_vtx-&gt;<a class="code" href="classHepMC_1_1GenVertex.html#26d71cbe0c175febcc008edf18df004e" title="vertex position and time">position</a>()==<a class="code" href="classHepMC_1_1FourVector.html" title="FourVector is a simple representation of a physics 4 vector.">FourVector</a>(0,0,0,0) ) {
<a name="l00233"></a>00233             prod_vtx-&gt;<a class="code" href="classHepMC_1_1GenVertex.html#d3aab63f14a28dd66b294f13a5767762" title="set vertex position and time">set_position</a>( prod_pos );
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235         <span class="comment">// d. loop over mothers to make sure their end_vertices are</span>
<a name="l00236"></a>00236         <span class="comment">//     consistent</span>
<a name="l00237"></a>00237         mother = <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(i);
<a name="l00238"></a>00238         <span class="keywordflow">while</span> ( prod_vtx &amp;&amp; mother &gt; 0 ) {
<a name="l00239"></a>00239             <span class="keywordflow">if</span> ( !hepevt_particle[mother]-&gt;end_vertex() ) {
<a name="l00240"></a>00240                 <span class="comment">// if end vertex of the mother isn't specified, do it now</span>
<a name="l00241"></a>00241                 prod_vtx-&gt;<a class="code" href="classHepMC_1_1GenVertex.html#62a329fbb235284e70c24e1bf7ba49e8" title="add incoming particle">add_particle_in</a>( hepevt_particle[mother] );
<a name="l00242"></a>00242             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hepevt_particle[mother]-&gt;end_vertex() != prod_vtx ) {
<a name="l00243"></a>00243                 <span class="comment">// problem scenario --- the mother already has a decay</span>
<a name="l00244"></a>00244                 <span class="comment">// vertex which differs from the daughter's produciton </span>
<a name="l00245"></a>00245                 <span class="comment">// vertex. This means there is internal</span>
<a name="l00246"></a>00246                 <span class="comment">// inconsistency in the HEPEVT event record. Print an</span>
<a name="l00247"></a>00247                 <span class="comment">// error</span>
<a name="l00248"></a>00248                 <span class="comment">// Note: we could provide a fix by joining the two </span>
<a name="l00249"></a>00249                 <span class="comment">//       vertices with a dummy particle if the problem</span>
<a name="l00250"></a>00250                 <span class="comment">//       arrises often with any particular generator.</span>
<a name="l00251"></a>00251                 <span class="keywordflow">if</span> ( m_print_inconsistency_errors ) {
<a name="l00252"></a>00252                   std::cerr
<a name="l00253"></a>00253                     &lt;&lt; <span class="stringliteral">"HepMC::IO_HERWIG: inconsistent mother/daugher "</span>
<a name="l00254"></a>00254                     &lt;&lt; <span class="stringliteral">"information in HEPEVT event "</span> 
<a name="l00255"></a>00255                     &lt;&lt; <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#75fe312f2cfb59db1b8dd7796be78dea" title="event number">HEPEVT_Wrapper::event_number</a>()
<a name="l00256"></a>00256                     &lt;&lt; <span class="stringliteral">". \n I recommend you try "</span>
<a name="l00257"></a>00257                     &lt;&lt; <span class="stringliteral">"inspecting the event first with "</span>
<a name="l00258"></a>00258                     &lt;&lt; <span class="stringliteral">"\n\tHEPEVT_Wrapper::check_hepevt_consistency()"</span>
<a name="l00259"></a>00259                     &lt;&lt; <span class="stringliteral">"\n This warning can be turned off with the "</span>
<a name="l00260"></a>00260                     &lt;&lt; <span class="stringliteral">"IO_HERWIG::print_inconsistency_errors switch."</span>
<a name="l00261"></a>00261                     &lt;&lt; std::endl;
<a name="l00262"></a>00262                   hepevt_particle[mother]-&gt;print(std::cerr);
<a name="l00263"></a>00263                   std::cerr
<a name="l00264"></a>00264                     &lt;&lt; <span class="stringliteral">"problem vertices are: (prod_vtx, mother)"</span> &lt;&lt; std::endl;
<a name="l00265"></a>00265                   <span class="keywordflow">if</span> ( prod_vtx ) prod_vtx-&gt;<a class="code" href="classHepMC_1_1GenVertex.html#6056715d054c2f22c33e5de4f35367a4" title="print vertex information">print</a>(std::cerr);
<a name="l00266"></a>00266                   hepevt_particle[mother]-&gt;end_vertex()-&gt;print(std::cerr);
<a name="l00267"></a>00267                 }
<a name="l00268"></a>00268             }
<a name="l00269"></a>00269             <span class="keywordflow">if</span> ( ++mother &gt; <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#bffc1f6aa474d1a7f4822142cb82df41" title="index of last mother">HEPEVT_Wrapper::last_parent</a>(i) ) mother = 0;
<a name="l00270"></a>00270         }
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     <span class="keywordtype">void</span> <a class="code" href="classHepMC_1_1IO__HERWIG.html#8077ede98c4040631f28424c6624a50b" title="make a decay vertex">IO_HERWIG::build_end_vertex</a>
<a name="l00274"></a><a class="code" href="classHepMC_1_1IO__HERWIG.html#8077ede98c4040631f28424c6624a50b">00274</a>     ( <span class="keywordtype">int</span> i, std::vector&lt;GenParticle*&gt;&amp; hepevt_particle, <a class="code" href="classHepMC_1_1GenEvent.html" title="The GenEvent class is the core of HepMC.">GenEvent</a>* evt ) 
<a name="l00275"></a>00275     {
<a name="l00279"></a>00279         <span class="comment">//    Identical steps as for build_production_vertex</span>
<a name="l00280"></a>00280         <a class="code" href="classHepMC_1_1GenParticle.html" title="The GenParticle class contains information about generated particles.">GenParticle</a>* <a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a> = hepevt_particle[i];
<a name="l00281"></a>00281         <span class="comment">// a.</span>
<a name="l00282"></a>00282         <span class="keywordtype">int</span> daughter = <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#86faac133d2c259fec6ee6c1269f379f" title="index of 1st daughter">HEPEVT_Wrapper::first_child</a>(i);
<a name="l00283"></a>00283         <a class="code" href="classHepMC_1_1GenVertex.html" title="GenVertex contains information about decay vertices.">GenVertex</a>* end_vtx = <a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a>-&gt;end_vertex();
<a name="l00284"></a>00284         <span class="keywordflow">while</span> ( !end_vtx &amp;&amp; daughter &gt; 0 ) {
<a name="l00285"></a>00285             end_vtx = hepevt_particle[daughter]-&gt;production_vertex();
<a name="l00286"></a>00286             <span class="keywordflow">if</span> ( end_vtx ) end_vtx-&gt;<a class="code" href="classHepMC_1_1GenVertex.html#62a329fbb235284e70c24e1bf7ba49e8" title="add incoming particle">add_particle_in</a>( <a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a> );
<a name="l00287"></a>00287             <span class="keywordflow">if</span> ( ++daughter &gt; <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#143ddd0d4b55c3d47409c230979f25c5" title="index of last daughter">HEPEVT_Wrapper::last_child</a>(i) ) daughter = 0;
<a name="l00288"></a>00288         }
<a name="l00289"></a>00289         <span class="comment">// b. (different from 3c. because HEPEVT particle can not know its</span>
<a name="l00290"></a>00290         <span class="comment">//        decay position )</span>
<a name="l00291"></a>00291         <span class="keywordflow">if</span> ( !end_vtx &amp;&amp; <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#4e1700f9a9adf4b078d9eae99d069a41" title="number of children">HEPEVT_Wrapper::number_children</a>(i)&gt;0 ) {
<a name="l00292"></a>00292             end_vtx = <span class="keyword">new</span> <a class="code" href="classHepMC_1_1GenVertex.html" title="GenVertex contains information about decay vertices.">GenVertex</a>();
<a name="l00293"></a>00293             end_vtx-&gt;<a class="code" href="classHepMC_1_1GenVertex.html#62a329fbb235284e70c24e1bf7ba49e8" title="add incoming particle">add_particle_in</a>( <a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a> );
<a name="l00294"></a>00294             evt-&gt;<a class="code" href="classHepMC_1_1GenEvent.html#351fd8c688bb1791877a56a956c8b005" title="adds to evt and adopts">add_vertex</a>( end_vtx );
<a name="l00295"></a>00295         }
<a name="l00296"></a>00296         <span class="comment">// c+d. loop over daughters to make sure their production vertices </span>
<a name="l00297"></a>00297         <span class="comment">//    point back to the current vertex.</span>
<a name="l00298"></a>00298         <span class="comment">//    We get the vertex position from the daughter as well.</span>
<a name="l00299"></a>00299         daughter = <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#86faac133d2c259fec6ee6c1269f379f" title="index of 1st daughter">HEPEVT_Wrapper::first_child</a>(i);
<a name="l00300"></a>00300         <span class="keywordflow">while</span> ( end_vtx &amp;&amp; daughter &gt; 0 ) {
<a name="l00301"></a>00301             <span class="keywordflow">if</span> ( !hepevt_particle[daughter]-&gt;production_vertex() ) {
<a name="l00302"></a>00302                 <span class="comment">// if end vertex of the mother isn't specified, do it now</span>
<a name="l00303"></a>00303                 end_vtx-&gt;<a class="code" href="classHepMC_1_1GenVertex.html#eba71fdc7561e80fbbea2f60ac9358e7" title="add outgoing particle">add_particle_out</a>( hepevt_particle[daughter] );
<a name="l00304"></a>00304                 <span class="comment">// </span>
<a name="l00305"></a>00305                 <span class="comment">// 2001-03-29 M.Dobbs, fill vertex the position.</span>
<a name="l00306"></a>00306                 <span class="keywordflow">if</span> ( end_vtx-&gt;<a class="code" href="classHepMC_1_1GenVertex.html#26d71cbe0c175febcc008edf18df004e" title="vertex position and time">position</a>()==<a class="code" href="classHepMC_1_1FourVector.html" title="FourVector is a simple representation of a physics 4 vector.">FourVector</a>(0,0,0,0) ) {
<a name="l00307"></a>00307                     <a class="code" href="classHepMC_1_1FourVector.html" title="FourVector is a simple representation of a physics 4 vector.">FourVector</a> prod_pos( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#5e6b99a24d23c6a9ee12eddb3ee6b3f2" title="X Production vertex.">HEPEVT_Wrapper::x</a>(daughter), 
<a name="l00308"></a>00308                                                <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#9ddff6e0faa83005830621428c01eb25" title="Y Production vertex.">HEPEVT_Wrapper::y</a>(daughter), 
<a name="l00309"></a>00309                                                <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#68b9f32b2c5cefda476a3b05bbe831fd" title="Z Production vertex.">HEPEVT_Wrapper::z</a>(daughter), 
<a name="l00310"></a>00310                                                <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#b302ab96378802b5d3549618ed2f063b" title="production time">HEPEVT_Wrapper::t</a>(daughter) 
<a name="l00311"></a>00311                         );
<a name="l00312"></a>00312                     <span class="keywordflow">if</span> ( prod_pos != <a class="code" href="classHepMC_1_1FourVector.html" title="FourVector is a simple representation of a physics 4 vector.">FourVector</a>(0,0,0,0) ) {
<a name="l00313"></a>00313                         end_vtx-&gt;<a class="code" href="classHepMC_1_1GenVertex.html#d3aab63f14a28dd66b294f13a5767762" title="set vertex position and time">set_position</a>( prod_pos );
<a name="l00314"></a>00314                     }
<a name="l00315"></a>00315                 }
<a name="l00316"></a>00316             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hepevt_particle[daughter]-&gt;production_vertex() 
<a name="l00317"></a>00317                        != end_vtx){
<a name="l00318"></a>00318                 <span class="comment">// problem scenario --- the daughter already has a prod</span>
<a name="l00319"></a>00319                 <span class="comment">// vertex which differs from the mother's end </span>
<a name="l00320"></a>00320                 <span class="comment">// vertex. This means there is internal</span>
<a name="l00321"></a>00321                 <span class="comment">// inconsistency in the HEPEVT event record. Print an</span>
<a name="l00322"></a>00322                 <span class="comment">// error</span>
<a name="l00323"></a>00323                 <span class="keywordflow">if</span> ( m_print_inconsistency_errors ) std::cerr
<a name="l00324"></a>00324                     &lt;&lt; <span class="stringliteral">"HepMC::IO_HERWIG: inconsistent mother/daugher "</span>
<a name="l00325"></a>00325                     &lt;&lt; <span class="stringliteral">"information in HEPEVT event "</span> 
<a name="l00326"></a>00326                     &lt;&lt; <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#75fe312f2cfb59db1b8dd7796be78dea" title="event number">HEPEVT_Wrapper::event_number</a>()
<a name="l00327"></a>00327                     &lt;&lt; <span class="stringliteral">". \n I recommend you try "</span>
<a name="l00328"></a>00328                     &lt;&lt; <span class="stringliteral">"inspecting the event first with "</span>
<a name="l00329"></a>00329                     &lt;&lt; <span class="stringliteral">"\n\tHEPEVT_Wrapper::check_hepevt_consistency()"</span>
<a name="l00330"></a>00330                     &lt;&lt; <span class="stringliteral">"\n This warning can be turned off with the "</span>
<a name="l00331"></a>00331                     &lt;&lt; <span class="stringliteral">"IO_HERWIG::print_inconsistency_errors switch."</span>
<a name="l00332"></a>00332                     &lt;&lt; std::endl;
<a name="l00333"></a>00333             }
<a name="l00334"></a>00334             <span class="keywordflow">if</span> ( ++daughter &gt; <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#143ddd0d4b55c3d47409c230979f25c5" title="index of last daughter">HEPEVT_Wrapper::last_child</a>(i) ) daughter = 0;
<a name="l00335"></a>00335         }
<a name="l00336"></a>00336         <span class="keywordflow">if</span> ( !<a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a>-&gt;end_vertex() &amp;&amp; !<a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a>-&gt;production_vertex() ) {
<a name="l00337"></a>00337             <span class="comment">// Added 2001-11-04, to try and handle Isajet problems.</span>
<a name="l00338"></a>00338             <a class="code" href="classHepMC_1_1IO__HERWIG.html#6de881de5bbbf579695522af451814a7" title="make a production vertex">build_production_vertex</a>( i, hepevt_particle, evt );
<a name="l00339"></a>00339         }
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341 
<a name="l00342"></a><a class="code" href="classHepMC_1_1IO__HERWIG.html#2afff99e4948621126d1211272b3fb02">00342</a>     <a class="code" href="classHepMC_1_1GenParticle.html" title="The GenParticle class contains information about generated particles.">GenParticle</a>* <a class="code" href="classHepMC_1_1IO__HERWIG.html#2afff99e4948621126d1211272b3fb02" title="make a particle">IO_HERWIG::build_particle</a>( <span class="keywordtype">int</span> index ) {
<a name="l00344"></a>00344         <span class="comment">// </span>
<a name="l00345"></a>00345         <a class="code" href="classHepMC_1_1GenParticle.html" title="The GenParticle class contains information about generated particles.">GenParticle</a>* <a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a> 
<a name="l00346"></a>00346             = <span class="keyword">new</span> <a class="code" href="classHepMC_1_1GenParticle.html" title="The GenParticle class contains information about generated particles.">GenParticle</a>( <a class="code" href="classHepMC_1_1FourVector.html" title="FourVector is a simple representation of a physics 4 vector.">FourVector</a>( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#930a8cc2c98573500db7ad5b41853fb5" title="X momentum.">HEPEVT_Wrapper::px</a>(index), 
<a name="l00347"></a>00347                                                  <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#18a3ef6191eddf2baa8a7197e8301c9e" title="Y momentum.">HEPEVT_Wrapper::py</a>(index), 
<a name="l00348"></a>00348                                                  <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#61047d6f9fbb08bdf286cfaa0be03222" title="Z momentum.">HEPEVT_Wrapper::pz</a>(index), 
<a name="l00349"></a>00349                                                  <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#3ed198bf4f4a70fa637e6b93702ea940" title="Energy.">HEPEVT_Wrapper::e</a>(index) ),
<a name="l00350"></a>00350                                <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#dab25a5f58694ea47c1a51ea56e4b42f" title="PDG particle id.">HEPEVT_Wrapper::id</a>(index), 
<a name="l00351"></a>00351                                <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(index) );
<a name="l00352"></a>00352         <a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a>-&gt;setGeneratedMass( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#162dddfa4b5ef7651341d1b70ea9c843" title="generated mass">HEPEVT_Wrapper::m</a>(index) );
<a name="l00353"></a>00353         <a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a>-&gt;suggest_barcode( index );
<a name="l00354"></a>00354         <span class="keywordflow">return</span> <a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a>;
<a name="l00355"></a>00355     }
<a name="l00356"></a>00356 
<a name="l00357"></a><a class="code" href="classHepMC_1_1IO__HERWIG.html#7606a11af5e487c4340e8908729769f9">00357</a>     <span class="keywordtype">int</span> <a class="code" href="classHepMC_1_1IO__HERWIG.html#7606a11af5e487c4340e8908729769f9" title="find this particle in the map">IO_HERWIG::find_in_map</a>( <span class="keyword">const</span> std::map&lt;GenParticle*,int&gt;&amp; m, 
<a name="l00358"></a>00358                                 <a class="code" href="classHepMC_1_1GenParticle.html" title="The GenParticle class contains information about generated particles.">GenParticle</a>* <a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a>)<span class="keyword"> const </span>{
<a name="l00359"></a>00359         std::map&lt;GenParticle*,int&gt;::const_iterator iter = m.find(<a class="code" href="PythiaWrapper5__720_8h.html#8e241458f851615b53df90ab6231f85e">p</a>);
<a name="l00360"></a>00360         <span class="keywordflow">if</span> ( iter == m.end() ) <span class="keywordflow">return</span> 0;
<a name="l00361"></a>00361         <span class="keywordflow">return</span> iter-&gt;second;
<a name="l00362"></a>00362     }
<a name="l00363"></a>00363 
<a name="l00364"></a><a class="code" href="classHepMC_1_1IO__HERWIG.html#40fc149a9760dc7b03b08402f16b7929">00364</a>     <span class="keywordtype">void</span> <a class="code" href="classHepMC_1_1IO__HERWIG.html#40fc149a9760dc7b03b08402f16b7929" title="make the HERWIG HEPEVT common block look like the standard">IO_HERWIG::repair_hepevt</a>()<span class="keyword"> const </span>{
<a name="l00387"></a>00387 
<a name="l00388"></a>00388         <span class="comment">// Make sure hepvt isn't empty.</span>
<a name="l00389"></a>00389         <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#69b67d3c95321dc6130996e086480e86" title="num entries in current evt">HEPEVT_Wrapper::number_entries</a>() &lt;= 0 ) <span class="keywordflow">return</span>;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391         <span class="comment">// Find the index of the beam-beam collision and of the hard subprocess</span>
<a name="l00392"></a>00392         <span class="comment">// Later we will assume that </span>
<a name="l00393"></a>00393         <span class="comment">//              101 ---&gt; 121 \. </span>
<a name="l00394"></a>00394         <span class="comment">//                             X  Hard subprocess</span>
<a name="l00395"></a>00395         <span class="comment">//              102 ---&gt; 122 /</span>
<a name="l00396"></a>00396         <span class="comment">// </span>
<a name="l00397"></a>00397         <span class="keywordtype">int</span> index_collision = 0;
<a name="l00398"></a>00398         <span class="keywordtype">int</span> index_hard = 0;
<a name="l00399"></a>00399         <span class="keywordtype">int</span> index_101 = 0;
<a name="l00400"></a>00400         <span class="keywordtype">int</span> index_102 = 0;
<a name="l00401"></a>00401         <span class="keywordtype">int</span> index_121 = 0;
<a name="l00402"></a>00402         <span class="keywordtype">int</span> index_122 = 0;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 1; i &lt;=<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#69b67d3c95321dc6130996e086480e86" title="num entries in current evt">HEPEVT_Wrapper::number_entries</a>(); i++ ) {
<a name="l00405"></a>00405             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(i)==101 ) index_101=i;
<a name="l00406"></a>00406             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(i)==102 ) index_102=i;
<a name="l00407"></a>00407             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(i)==103 ) index_collision=i;
<a name="l00408"></a>00408             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(i)==120 ) index_hard=i;
<a name="l00409"></a>00409             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(i)==121 ) index_121=i;
<a name="l00410"></a>00410             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(i)==122 ) index_122=i;
<a name="l00411"></a>00411             <span class="keywordflow">if</span> ( index_collision!=0 &amp;&amp; index_hard!=0 &amp;&amp; index_101!=0 &amp;&amp; 
<a name="l00412"></a>00412                  index_102!=0 &amp;&amp; index_121!=0 &amp;&amp; index_122!=0 ) <span class="keywordflow">break</span>;
<a name="l00413"></a>00413         }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415         <span class="comment">// The mother daughter information for the hard subprocess entry (120)</span>
<a name="l00416"></a>00416         <span class="comment">// IS correct, whereas the information for the particles participating</span>
<a name="l00417"></a>00417         <span class="comment">// in the hard subprocess contains instead the color flow relationships</span>
<a name="l00418"></a>00418         <span class="comment">// Transfer the hard subprocess info onto the other particles</span>
<a name="l00419"></a>00419         <span class="comment">// in the hard subprocess.</span>
<a name="l00420"></a>00420         <span class="comment">//</span>
<a name="l00421"></a>00421         <span class="comment">// We cannot specify daughters of the incoming hard process particles</span>
<a name="l00422"></a>00422         <span class="comment">// because they have some daughters (their showered versions) which </span>
<a name="l00423"></a>00423         <span class="comment">// are not adjacent in the particle record, so we cannot properly </span>
<a name="l00424"></a>00424         <span class="comment">// set the daughter indices in hepevt.</span>
<a name="l00425"></a>00425         <span class="comment">//</span>
<a name="l00426"></a>00426         <span class="keywordflow">if</span> (index_121) <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f7ddc2d98d6854d90eb9f910246e29ed" title="define parents of a particle">HEPEVT_Wrapper::set_parents</a>(index_121, index_101, 0 );
<a name="l00427"></a>00427         <span class="keywordflow">if</span> (index_121) <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#03d1459146dfa6bd05b7b1db4bd784eb" title="define children of a particle">HEPEVT_Wrapper::set_children</a>( index_121, 0, 0 );
<a name="l00428"></a>00428         <span class="keywordflow">if</span> (index_122) <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f7ddc2d98d6854d90eb9f910246e29ed" title="define parents of a particle">HEPEVT_Wrapper::set_parents</a>(index_122, index_102, 0 );
<a name="l00429"></a>00429         <span class="keywordflow">if</span> (index_122) <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#03d1459146dfa6bd05b7b1db4bd784eb" title="define children of a particle">HEPEVT_Wrapper::set_children</a>( index_122, 0, 0 );
<a name="l00430"></a>00430 
<a name="l00431"></a>00431         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#86faac133d2c259fec6ee6c1269f379f" title="index of 1st daughter">HEPEVT_Wrapper::first_child</a>(index_hard);
<a name="l00432"></a>00432               i &lt;= <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#143ddd0d4b55c3d47409c230979f25c5" title="index of last daughter">HEPEVT_Wrapper::last_child</a>(index_hard); i++ ) {
<a name="l00433"></a>00433             <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f7ddc2d98d6854d90eb9f910246e29ed" title="define parents of a particle">HEPEVT_Wrapper::set_parents</a>( 
<a name="l00434"></a>00434                 i, <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(index_hard), 
<a name="l00435"></a>00435                 <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#bffc1f6aa474d1a7f4822142cb82df41" title="index of last mother">HEPEVT_Wrapper::last_parent</a>(index_hard) );
<a name="l00436"></a>00436 
<a name="l00437"></a>00437             <span class="comment">// When the direct descendants of the hard process are hadrons,</span>
<a name="l00438"></a>00438             <span class="comment">// then the 2nd child contains color flow information, and so</span>
<a name="l00439"></a>00439             <span class="comment">// we zero it.</span>
<a name="l00440"></a>00440             <span class="comment">// However, if the direct descendant is status=195, then it is</span>
<a name="l00441"></a>00441             <span class="comment">// a non-hadron, and so the 2nd child does contain real mother</span>
<a name="l00442"></a>00442             <span class="comment">// daughter relationships. ( particularly relevant for H-&gt;WW,</span>
<a name="l00443"></a>00443             <span class="comment">//                           April 18, 2003 )</span>
<a name="l00444"></a>00444             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(i) != 195 ) {         
<a name="l00445"></a>00445               <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#03d1459146dfa6bd05b7b1db4bd784eb" title="define children of a particle">HEPEVT_Wrapper::set_children</a>(i,<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#86faac133d2c259fec6ee6c1269f379f" title="index of 1st daughter">HEPEVT_Wrapper::first_child</a>(i),0);
<a name="l00446"></a>00446             }
<a name="l00447"></a>00447         }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449         <span class="comment">// now zero the collision and hard entries.</span>
<a name="l00450"></a>00450         <span class="keywordflow">if</span> (index_hard) <a class="code" href="classHepMC_1_1IO__HERWIG.html#1f83a4b4c3b5da6e1ab672117e9dea13" title="zero out a HEPEVT pseudo particle">zero_hepevt_entry</a>(index_hard);
<a name="l00451"></a>00451         <span class="keywordflow">if</span> (index_hard) <a class="code" href="classHepMC_1_1IO__HERWIG.html#1f83a4b4c3b5da6e1ab672117e9dea13" title="zero out a HEPEVT pseudo particle">zero_hepevt_entry</a>(index_collision);
<a name="l00452"></a>00452 
<a name="l00453"></a>00453         <span class="comment">//     Loop over the particles individually and handle oddities</span>
<a name="l00454"></a>00454         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=1; i &lt;=<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#69b67d3c95321dc6130996e086480e86" title="num entries in current evt">HEPEVT_Wrapper::number_entries</a>(); i++ ) {
<a name="l00455"></a>00455 
<a name="l00456"></a>00456             <span class="comment">//       ----------- Fix ID codes ----------</span>
<a name="l00457"></a>00457             <span class="comment">//       particles with ID=94 are mirror images of their mothers:</span>
<a name="l00458"></a>00458             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#dab25a5f58694ea47c1a51ea56e4b42f" title="PDG particle id.">HEPEVT_Wrapper::id</a>(i)==94 ) {
<a name="l00459"></a>00459                 <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#230782d536e6476884ac8b571c896f58" title="set particle ID">HEPEVT_Wrapper::set_id</a>( 
<a name="l00460"></a>00460                     i, <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#dab25a5f58694ea47c1a51ea56e4b42f" title="PDG particle id.">HEPEVT_Wrapper::id</a>( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(i) ) );
<a name="l00461"></a>00461             }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463             <span class="comment">//     ----------- fix STATUS codes ------</span>
<a name="l00464"></a>00464             <span class="comment">//     status=100 particles are "cones" which carry only color info</span>
<a name="l00465"></a>00465             <span class="comment">//     throw them away</span>
<a name="l00466"></a>00466             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(i)==100 ) <a class="code" href="classHepMC_1_1IO__HERWIG.html#1f83a4b4c3b5da6e1ab672117e9dea13" title="zero out a HEPEVT pseudo particle">zero_hepevt_entry</a>(i);
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 
<a name="l00469"></a>00469             <span class="comment">// NOTE: status 101,102 particles are the beam particles.</span>
<a name="l00470"></a>00470             <span class="comment">//       status 121,129 particles are the hard subprocess particles</span>
<a name="l00471"></a>00471             <span class="comment">// we choose to allow the herwig particles to have herwig</span>
<a name="l00472"></a>00472             <span class="comment">// specific codes, and so we don't bother to change these</span>
<a name="l00473"></a>00473             <span class="comment">// to status =3.</span>
<a name="l00474"></a>00474 
<a name="l00475"></a>00475 
<a name="l00476"></a>00476 
<a name="l00477"></a>00477 
<a name="l00478"></a>00478             <span class="comment">//  ----------- fix some MOTHER/DAUGHTER relationships</span>
<a name="l00479"></a>00479             <span class="comment">//  Whenever the mother points to the hard process, it is referring</span>
<a name="l00480"></a>00480             <span class="comment">//  to a color flow, so we zero it.</span>
<a name="l00481"></a>00481             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#bffc1f6aa474d1a7f4822142cb82df41" title="index of last mother">HEPEVT_Wrapper::last_parent</a>(i)==index_hard ) {
<a name="l00482"></a>00482                 <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f7ddc2d98d6854d90eb9f910246e29ed" title="define parents of a particle">HEPEVT_Wrapper::set_parents</a>( 
<a name="l00483"></a>00483                     i, <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(i), 0 );
<a name="l00484"></a>00484             }
<a name="l00485"></a>00485 
<a name="l00486"></a>00486             <span class="comment">// It makes no sense to have a mother that is younger than you are!</span>
<a name="l00487"></a>00487 
<a name="l00488"></a>00488             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(i) &gt;= i ) {
<a name="l00489"></a>00489                 <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f7ddc2d98d6854d90eb9f910246e29ed" title="define parents of a particle">HEPEVT_Wrapper::set_parents</a>( i, 0, 0 );
<a name="l00490"></a>00490             }
<a name="l00491"></a>00491             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#bffc1f6aa474d1a7f4822142cb82df41" title="index of last mother">HEPEVT_Wrapper::last_parent</a>(i) &gt;= i ) {
<a name="l00492"></a>00492                 <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f7ddc2d98d6854d90eb9f910246e29ed" title="define parents of a particle">HEPEVT_Wrapper::set_parents</a>( 
<a name="l00493"></a>00493                     i, <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(i), 0 );
<a name="l00494"></a>00494             }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496             <span class="comment">// Whenever the second mother/daughter has a lower index than the</span>
<a name="l00497"></a>00497             <span class="comment">// first, it means the second mother/daughter contains color</span>
<a name="l00498"></a>00498             <span class="comment">// info. Purge it.</span>
<a name="l00499"></a>00499             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#bffc1f6aa474d1a7f4822142cb82df41" title="index of last mother">HEPEVT_Wrapper::last_parent</a>(i) &lt;= 
<a name="l00500"></a>00500                  <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(i) ) {
<a name="l00501"></a>00501                 <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f7ddc2d98d6854d90eb9f910246e29ed" title="define parents of a particle">HEPEVT_Wrapper::set_parents</a>( 
<a name="l00502"></a>00502                     i, <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(i), 0 );
<a name="l00503"></a>00503             }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#143ddd0d4b55c3d47409c230979f25c5" title="index of last daughter">HEPEVT_Wrapper::last_child</a>(i) &lt;= 
<a name="l00506"></a>00506                  <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#86faac133d2c259fec6ee6c1269f379f" title="index of 1st daughter">HEPEVT_Wrapper::first_child</a>(i) ) {
<a name="l00507"></a>00507                 <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#03d1459146dfa6bd05b7b1db4bd784eb" title="define children of a particle">HEPEVT_Wrapper::set_children</a>(
<a name="l00508"></a>00508                     i, <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#86faac133d2c259fec6ee6c1269f379f" title="index of 1st daughter">HEPEVT_Wrapper::first_child</a>(i), 0 );
<a name="l00509"></a>00509             }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511             <span class="comment">// The mothers &amp; daughters of a soft centre of mass (stat=170) seem</span>
<a name="l00512"></a>00512             <span class="comment">// to be correct, but they are out of sequence. The information is</span>
<a name="l00513"></a>00513             <span class="comment">// elsewhere in the event record, so zero it.</span>
<a name="l00514"></a>00514             <span class="comment">//</span>
<a name="l00515"></a>00515             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(i) == 170 ) {
<a name="l00516"></a>00516                 <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f7ddc2d98d6854d90eb9f910246e29ed" title="define parents of a particle">HEPEVT_Wrapper::set_parents</a>( i, 0, 0 );
<a name="l00517"></a>00517                 <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#03d1459146dfa6bd05b7b1db4bd784eb" title="define children of a particle">HEPEVT_Wrapper::set_children</a>( i, 0, 0 );
<a name="l00518"></a>00518             }
<a name="l00519"></a>00519 
<a name="l00520"></a>00520             <span class="comment">// Recognise clusters.</span>
<a name="l00521"></a>00521             <span class="comment">// Case 1: cluster has particle parents.  </span>
<a name="l00522"></a>00522             <span class="comment">// Clusters normally DO point to its two</span>
<a name="l00523"></a>00523             <span class="comment">// correct mothers, but those 2 mothers are rarely adjacent in the</span>
<a name="l00524"></a>00524             <span class="comment">// event record ... so the mother information might say something</span>
<a name="l00525"></a>00525             <span class="comment">// like 123,48 where index123 and index48 really are the correct</span>
<a name="l00526"></a>00526             <span class="comment">// mothers... however the hepevt standard states that the mother</span>
<a name="l00527"></a>00527             <span class="comment">// pointers should give the index range. So we would have to</span>
<a name="l00528"></a>00528             <span class="comment">// reorder the event record and add entries if we wanted to use</span>
<a name="l00529"></a>00529             <span class="comment">// it. Instead we just zero the mothers, since all of that</span>
<a name="l00530"></a>00530             <span class="comment">// information is contained in the daughter information of the</span>
<a name="l00531"></a>00531             <span class="comment">// mothers.</span>
<a name="l00532"></a>00532             <span class="comment">// Case 2: cluster has a soft process centre of mass (stat=170)</span>
<a name="l00533"></a>00533             <span class="comment">// as parent. This is ok, keep it.</span>
<a name="l00534"></a>00534             <span class="comment">//</span>
<a name="l00535"></a>00535             <span class="comment">// Note if we were going directly to HepMC, then we could </span>
<a name="l00536"></a>00536             <span class="comment">//  use this information properly!</span>
<a name="l00537"></a>00537 
<a name="l00538"></a>00538             <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#dab25a5f58694ea47c1a51ea56e4b42f" title="PDG particle id.">HEPEVT_Wrapper::id</a>(i)==91 ) {
<a name="l00539"></a>00539                 <span class="comment">// if the cluster comes from a SOFT (id=0,stat=170)</span>
<a name="l00540"></a>00540                 <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(i)) 
<a name="l00541"></a>00541                      == 170 ) {
<a name="l00542"></a>00542                     ; <span class="comment">// In this case the mothers are ok</span>
<a name="l00543"></a>00543                 } <span class="keywordflow">else</span> {
<a name="l00544"></a>00544                     <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f7ddc2d98d6854d90eb9f910246e29ed" title="define parents of a particle">HEPEVT_Wrapper::set_parents</a>( i, 0, 0 );
<a name="l00545"></a>00545                 }
<a name="l00546"></a>00546             }
<a name="l00547"></a>00547         }
<a name="l00548"></a>00548         
<a name="l00549"></a>00549         <span class="comment">//     ---------- Loop over the particles individually and look </span>
<a name="l00550"></a>00550         <span class="comment">//                for mother/daughter inconsistencies.</span>
<a name="l00551"></a>00551         <span class="comment">// We consider a mother daughter relationship to be valid</span>
<a name="l00552"></a>00552         <span class="comment">// ONLy when the mother points to the daughter AND the</span>
<a name="l00553"></a>00553         <span class="comment">// daughter points back (true valid bidirectional</span>
<a name="l00554"></a>00554         <span class="comment">// pointers) OR when a one thing points to the other, but</span>
<a name="l00555"></a>00555         <span class="comment">// the other points to zero. If this isn't true, we zero</span>
<a name="l00556"></a>00556         <span class="comment">// the offending relationship.</span>
<a name="l00557"></a>00557 
<a name="l00558"></a>00558         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=1; i &lt;=<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#69b67d3c95321dc6130996e086480e86" title="num entries in current evt">HEPEVT_Wrapper::number_entries</a>(); i++ ) {
<a name="l00559"></a>00559             <span class="comment">// loop over parents</span>
<a name="l00560"></a>00560             <span class="keywordtype">int</span> ifirst = <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(i);
<a name="l00561"></a>00561             <span class="keywordtype">int</span> ilast = <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#bffc1f6aa474d1a7f4822142cb82df41" title="index of last mother">HEPEVT_Wrapper::last_parent</a>(i);
<a name="l00562"></a>00562             <span class="keywordflow">if</span> ( ilast == 0 ) ilast = <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(i);
<a name="l00563"></a>00563             <span class="keywordtype">bool</span> first_is_acceptable = <span class="keyword">true</span>;
<a name="l00564"></a>00564             <span class="keywordtype">bool</span> last_is_acceptable = <span class="keyword">true</span>;
<a name="l00565"></a>00565             <span class="comment">// check for out of range.</span>
<a name="l00566"></a>00566             <span class="keywordflow">if</span> ( ifirst&gt;=i || ifirst&lt;0 ) first_is_acceptable = <span class="keyword">false</span>;
<a name="l00567"></a>00567             <span class="keywordflow">if</span> ( ilast&gt;=i || ilast&lt;ifirst || ilast&lt;0 )last_is_acceptable=<span class="keyword">false</span>;
<a name="l00568"></a>00568             <span class="keywordflow">if</span> ( first_is_acceptable ) {
<a name="l00569"></a>00569                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = ifirst; j&lt;=ilast; j++ ) {
<a name="l00570"></a>00570                     <span class="comment">// these are the acceptable outcomes</span>
<a name="l00571"></a>00571                     <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#86faac133d2c259fec6ee6c1269f379f" title="index of 1st daughter">HEPEVT_Wrapper::first_child</a>(j)==i ) {;} 
<a name="l00572"></a>00572                     <span class="comment">// watch out</span>
<a name="l00573"></a>00573                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#86faac133d2c259fec6ee6c1269f379f" title="index of 1st daughter">HEPEVT_Wrapper::first_child</a>(j) &lt;=i &amp;&amp; 
<a name="l00574"></a>00574                               <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#143ddd0d4b55c3d47409c230979f25c5" title="index of last daughter">HEPEVT_Wrapper::last_child</a>(j) &gt;=i ) {;}
<a name="l00575"></a>00575                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#86faac133d2c259fec6ee6c1269f379f" title="index of 1st daughter">HEPEVT_Wrapper::first_child</a>(j) ==0 &amp;&amp; 
<a name="l00576"></a>00576                               <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#143ddd0d4b55c3d47409c230979f25c5" title="index of last daughter">HEPEVT_Wrapper::last_child</a>(j) ==0 ) {;}
<a name="l00577"></a>00577 
<a name="l00578"></a>00578                     <span class="comment">// Error Condition:</span>
<a name="l00579"></a>00579                     <span class="comment">// modified by MADobbs@lbl.gov April 21, 2003</span>
<a name="l00580"></a>00580                     <span class="comment">// we distinguish between the first parent and all parents</span>
<a name="l00581"></a>00581                     <span class="comment">//  being incorrect</span>
<a name="l00582"></a>00582                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j==ifirst) { first_is_acceptable = <span class="keyword">false</span>; <span class="keywordflow">break</span>; }
<a name="l00583"></a>00583                     <span class="keywordflow">else</span> { last_is_acceptable = <span class="keyword">false</span>; <span class="keywordflow">break</span>; }
<a name="l00584"></a>00584                 }
<a name="l00585"></a>00585             }
<a name="l00586"></a>00586             <span class="comment">// if any one of the mothers gave a bad outcome, zero all mothers</span>
<a name="l00587"></a>00587             <span class="keywordflow">if</span> ( !first_is_acceptable ) {
<a name="l00588"></a>00588               <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f7ddc2d98d6854d90eb9f910246e29ed" title="define parents of a particle">HEPEVT_Wrapper::set_parents</a>( i, 0, 0 );
<a name="l00589"></a>00589             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !last_is_acceptable ) {
<a name="l00590"></a>00590               <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f7ddc2d98d6854d90eb9f910246e29ed" title="define parents of a particle">HEPEVT_Wrapper::set_parents</a>(i,<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(i),0);
<a name="l00591"></a>00591             }
<a name="l00592"></a>00592         }
<a name="l00593"></a>00593         <span class="comment">// Note: it's important to finish the mother loop, before</span>
<a name="l00594"></a>00594         <span class="comment">// starting the daughter loop ... since many mother relations</span>
<a name="l00595"></a>00595         <span class="comment">// will be zero'd which will validate the daughters.... i.e.,</span>
<a name="l00596"></a>00596         <span class="comment">// we want relationships like:</span>
<a name="l00597"></a>00597         <span class="comment">//      IHEP    ID      IDPDG IST MO1 MO2 DA1 DA2</span>
<a name="l00598"></a>00598         <span class="comment">//        27 TQRK           6   3  26  26  30  30</span>
<a name="l00599"></a>00599         <span class="comment">//        30 TQRK           6 155  26  11  31  32</span>
<a name="l00600"></a>00600         <span class="comment">// to come out right.</span>
<a name="l00601"></a>00601 
<a name="l00602"></a>00602         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=1; i &lt;=<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#69b67d3c95321dc6130996e086480e86" title="num entries in current evt">HEPEVT_Wrapper::number_entries</a>(); i++ ) {
<a name="l00603"></a>00603             <span class="comment">// loop over daughters</span>
<a name="l00604"></a>00604             <span class="keywordtype">int</span> ifirst = <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#86faac133d2c259fec6ee6c1269f379f" title="index of 1st daughter">HEPEVT_Wrapper::first_child</a>(i);
<a name="l00605"></a>00605             <span class="keywordtype">int</span> ilast = <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#143ddd0d4b55c3d47409c230979f25c5" title="index of last daughter">HEPEVT_Wrapper::last_child</a>(i);
<a name="l00606"></a>00606             <span class="keywordflow">if</span> ( ilast==0 ) ilast = <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#86faac133d2c259fec6ee6c1269f379f" title="index of 1st daughter">HEPEVT_Wrapper::first_child</a>(i);
<a name="l00607"></a>00607             <span class="keywordtype">bool</span> is_acceptable = <span class="keyword">true</span>;
<a name="l00608"></a>00608             <span class="comment">// check for out of range.</span>
<a name="l00609"></a>00609             <span class="keywordflow">if</span> ( ifirst&lt;=i || ifirst&lt;0 ) is_acceptable = <span class="keyword">false</span>;
<a name="l00610"></a>00610             <span class="keywordflow">if</span> ( ilast&lt;=i || ilast&lt;ifirst || ilast&lt;0 ) is_acceptable = <span class="keyword">false</span>;
<a name="l00611"></a>00611             <span class="keywordflow">if</span> ( is_acceptable ) {
<a name="l00612"></a>00612                 <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = ifirst; j&lt;=ilast; j++ ) {
<a name="l00613"></a>00613                     <span class="comment">// these are the acceptable outcomes</span>
<a name="l00614"></a>00614                     <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(j)==i ) {;} 
<a name="l00615"></a>00615                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(j) &lt;=i &amp;&amp; 
<a name="l00616"></a>00616                               <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#bffc1f6aa474d1a7f4822142cb82df41" title="index of last mother">HEPEVT_Wrapper::last_parent</a>(j) &gt;=i ) {;}
<a name="l00617"></a>00617                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(j) ==0 &amp;&amp; 
<a name="l00618"></a>00618                               <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#bffc1f6aa474d1a7f4822142cb82df41" title="index of last mother">HEPEVT_Wrapper::last_parent</a>(j) ==0 ) {;}
<a name="l00619"></a>00619                     <span class="keywordflow">else</span> { is_acceptable = <span class="keyword">false</span>; } <span class="comment">// error condition </span>
<a name="l00620"></a>00620                 }
<a name="l00621"></a>00621             }
<a name="l00622"></a>00622             <span class="comment">// if any one of the children gave a bad outcome, zero all children</span>
<a name="l00623"></a>00623             <span class="keywordflow">if</span> ( !is_acceptable ) <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#03d1459146dfa6bd05b7b1db4bd784eb" title="define children of a particle">HEPEVT_Wrapper::set_children</a>( i, 0, 0 );
<a name="l00624"></a>00624         }
<a name="l00625"></a>00625 
<a name="l00626"></a>00626         <span class="comment">// fixme</span>
<a name="l00627"></a>00627 
<a name="l00628"></a>00628         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=1; i &lt;=<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#69b67d3c95321dc6130996e086480e86" title="num entries in current evt">HEPEVT_Wrapper::number_entries</a>(); i++ ) {
<a name="l00629"></a>00629             <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#230782d536e6476884ac8b571c896f58" title="set particle ID">HEPEVT_Wrapper::set_id</a>(
<a name="l00630"></a>00630                 i, <a class="code" href="classHepMC_1_1IO__HERWIG.html#05ba9f2697ec5543f26e0d64986da860" title="translate particle ID">translate_herwig_to_pdg_id</a>(<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#dab25a5f58694ea47c1a51ea56e4b42f" title="PDG particle id.">HEPEVT_Wrapper::id</a>(i)) );
<a name="l00631"></a>00631         }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633 
<a name="l00634"></a>00634         <span class="keywordflow">if</span> ( m_no_gaps_in_barcodes ) <a class="code" href="classHepMC_1_1IO__HERWIG.html#98257a567a2d6e719e15eb56b6b9bef9" title="deal with artifacts of repairing HEPEVT">remove_gaps_in_hepevt</a>();
<a name="l00635"></a>00635     }
<a name="l00636"></a>00636 
<a name="l00637"></a><a class="code" href="classHepMC_1_1IO__HERWIG.html#98257a567a2d6e719e15eb56b6b9bef9">00637</a>     <span class="keywordtype">void</span> <a class="code" href="classHepMC_1_1IO__HERWIG.html#98257a567a2d6e719e15eb56b6b9bef9" title="deal with artifacts of repairing HEPEVT">IO_HERWIG::remove_gaps_in_hepevt</a>()<span class="keyword"> const </span>{
<a name="l00643"></a>00643         std::vector&lt;int&gt; mymap(<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#69b67d3c95321dc6130996e086480e86" title="num entries in current evt">HEPEVT_Wrapper::number_entries</a>()+1,0);
<a name="l00644"></a>00644         <span class="keywordtype">int</span> ilast = 0;
<a name="l00645"></a>00645         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=1; i &lt;=<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#69b67d3c95321dc6130996e086480e86" title="num entries in current evt">HEPEVT_Wrapper::number_entries</a>(); i++ ) {
<a name="l00646"></a>00646             <span class="keywordflow">if</span> (<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(i)==0 &amp;&amp; <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#dab25a5f58694ea47c1a51ea56e4b42f" title="PDG particle id.">HEPEVT_Wrapper::id</a>(i)==0) {
<a name="l00647"></a>00647                 <span class="comment">// we remove all entries for which stat=0, id=0</span>
<a name="l00648"></a>00648                 mymap[i]=0;
<a name="l00649"></a>00649             } <span class="keywordflow">else</span> {
<a name="l00650"></a>00650                 ilast += 1;
<a name="l00651"></a>00651                 <span class="keywordflow">if</span> ( ilast != i ) {
<a name="l00652"></a>00652                     <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#e4906912975bc5387668f60358ccdbce" title="set particle status">HEPEVT_Wrapper::set_status</a>(ilast, 
<a name="l00653"></a>00653                                                <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f9397a180035031ac93cd6501efdc86f" title="status code">HEPEVT_Wrapper::status</a>(i) );
<a name="l00654"></a>00654                     <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#230782d536e6476884ac8b571c896f58" title="set particle ID">HEPEVT_Wrapper::set_id</a>(ilast, <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#dab25a5f58694ea47c1a51ea56e4b42f" title="PDG particle id.">HEPEVT_Wrapper::id</a>(i) );
<a name="l00655"></a>00655                     <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f7ddc2d98d6854d90eb9f910246e29ed" title="define parents of a particle">HEPEVT_Wrapper::set_parents</a>(
<a name="l00656"></a>00656                         ilast, 
<a name="l00657"></a>00657                         <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(i),
<a name="l00658"></a>00658                         <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#bffc1f6aa474d1a7f4822142cb82df41" title="index of last mother">HEPEVT_Wrapper::last_parent</a>(i) );
<a name="l00659"></a>00659                     <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#03d1459146dfa6bd05b7b1db4bd784eb" title="define children of a particle">HEPEVT_Wrapper::set_children</a>(
<a name="l00660"></a>00660                         ilast, 
<a name="l00661"></a>00661                         <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#86faac133d2c259fec6ee6c1269f379f" title="index of 1st daughter">HEPEVT_Wrapper::first_child</a>(i),
<a name="l00662"></a>00662                         <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#143ddd0d4b55c3d47409c230979f25c5" title="index of last daughter">HEPEVT_Wrapper::last_child</a>(i) );
<a name="l00663"></a>00663                     <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#31b65abdc8bfc12354bd52a72fe75aaa" title="set particle momentum">HEPEVT_Wrapper::set_momentum</a>(
<a name="l00664"></a>00664                         ilast, 
<a name="l00665"></a>00665                         <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#930a8cc2c98573500db7ad5b41853fb5" title="X momentum.">HEPEVT_Wrapper::px</a>(i), <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#18a3ef6191eddf2baa8a7197e8301c9e" title="Y momentum.">HEPEVT_Wrapper::py</a>(i),
<a name="l00666"></a>00666                         <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#61047d6f9fbb08bdf286cfaa0be03222" title="Z momentum.">HEPEVT_Wrapper::pz</a>(i), <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#3ed198bf4f4a70fa637e6b93702ea940" title="Energy.">HEPEVT_Wrapper::e</a>(i)  );
<a name="l00667"></a>00667                     <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#1b23c8c9ffb3a6e90ad0e00121ecadbc" title="set particle mass">HEPEVT_Wrapper::set_mass</a>(ilast, <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#162dddfa4b5ef7651341d1b70ea9c843" title="generated mass">HEPEVT_Wrapper::m</a>(i) );
<a name="l00668"></a>00668                     <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#c4cadb49454ee93175278703b1f0c33e" title="set particle production vertex">HEPEVT_Wrapper::set_position</a>(
<a name="l00669"></a>00669                         ilast, <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#5e6b99a24d23c6a9ee12eddb3ee6b3f2" title="X Production vertex.">HEPEVT_Wrapper::x</a>(i),<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#9ddff6e0faa83005830621428c01eb25" title="Y Production vertex.">HEPEVT_Wrapper::y</a>(i),
<a name="l00670"></a>00670                         <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#68b9f32b2c5cefda476a3b05bbe831fd" title="Z Production vertex.">HEPEVT_Wrapper::z</a>(i),<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#b302ab96378802b5d3549618ed2f063b" title="production time">HEPEVT_Wrapper::t</a>(i) );
<a name="l00671"></a>00671                 }
<a name="l00672"></a>00672                 mymap[i]=ilast;
<a name="l00673"></a>00673             }
<a name="l00674"></a>00674         }
<a name="l00675"></a>00675 
<a name="l00676"></a>00676         <span class="comment">// M. Dobbs (from Borut) - April 26, to fix tauolo/herwig past</span>
<a name="l00677"></a>00677         <span class="comment">// the end problem with daughter pointers: </span>
<a name="l00678"></a>00678         <span class="comment">// HEPEVT_Wrapper::set_number_entries( ilast );</span>
<a name="l00679"></a>00679 
<a name="l00680"></a>00680         <span class="comment">// Finally we need to re-map the mother/daughter pointers.      </span>
<a name="l00681"></a>00681         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=1; i &lt;=ilast; i++ ) {
<a name="l00682"></a>00682 
<a name="l00683"></a>00683             <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f7ddc2d98d6854d90eb9f910246e29ed" title="define parents of a particle">HEPEVT_Wrapper::set_parents</a>(
<a name="l00684"></a>00684                 i, 
<a name="l00685"></a>00685                 mymap[<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#6d4665dd23fd416ec7f70bdbba1a5fc1" title="index of 1st mother">HEPEVT_Wrapper::first_parent</a>(i)],
<a name="l00686"></a>00686                 mymap[<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#bffc1f6aa474d1a7f4822142cb82df41" title="index of last mother">HEPEVT_Wrapper::last_parent</a>(i)] );
<a name="l00687"></a>00687             <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#03d1459146dfa6bd05b7b1db4bd784eb" title="define children of a particle">HEPEVT_Wrapper::set_children</a>(
<a name="l00688"></a>00688                 i, 
<a name="l00689"></a>00689                 mymap[<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#86faac133d2c259fec6ee6c1269f379f" title="index of 1st daughter">HEPEVT_Wrapper::first_child</a>(i)],
<a name="l00690"></a>00690                 mymap[<a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#143ddd0d4b55c3d47409c230979f25c5" title="index of last daughter">HEPEVT_Wrapper::last_child</a>(i)] );
<a name="l00691"></a>00691         }
<a name="l00692"></a>00692         <span class="comment">// M. Dobbs (from Borut, part B) - April 26, to fix tauolo/herwig past</span>
<a name="l00693"></a>00693         <span class="comment">// the end problem with daughter pointers: </span>
<a name="l00694"></a>00694         <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#725ffa5dc1e3e838903b45ffcba1270d" title="set number of entries in HEPEVT">HEPEVT_Wrapper::set_number_entries</a>( ilast );
<a name="l00695"></a>00695     }
<a name="l00696"></a>00696 
<a name="l00697"></a><a class="code" href="classHepMC_1_1IO__HERWIG.html#1f83a4b4c3b5da6e1ab672117e9dea13">00697</a>     <span class="keywordtype">void</span> <a class="code" href="classHepMC_1_1IO__HERWIG.html#1f83a4b4c3b5da6e1ab672117e9dea13" title="zero out a HEPEVT pseudo particle">IO_HERWIG::zero_hepevt_entry</a>( <span class="keywordtype">int</span> i )<span class="keyword"> const </span>{
<a name="l00698"></a>00698       <span class="keywordflow">if</span> ( i &lt;=0 || i &gt; <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f25cc70d326c53d40560b8f9d29c3a83" title="size of common block">HepMC::HEPEVT_Wrapper::max_number_entries</a>() ) <span class="keywordflow">return</span>;
<a name="l00699"></a>00699       <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#e4906912975bc5387668f60358ccdbce" title="set particle status">HEPEVT_Wrapper::set_status</a>( i, 0 );
<a name="l00700"></a>00700       <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#230782d536e6476884ac8b571c896f58" title="set particle ID">HEPEVT_Wrapper::set_id</a>( i, 0 );
<a name="l00701"></a>00701       <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#f7ddc2d98d6854d90eb9f910246e29ed" title="define parents of a particle">HEPEVT_Wrapper::set_parents</a>( i, 0, 0 );
<a name="l00702"></a>00702       <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#03d1459146dfa6bd05b7b1db4bd784eb" title="define children of a particle">HEPEVT_Wrapper::set_children</a>( i, 0, 0 );
<a name="l00703"></a>00703       <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#31b65abdc8bfc12354bd52a72fe75aaa" title="set particle momentum">HEPEVT_Wrapper::set_momentum</a>( i, 0, 0, 0, 0 );
<a name="l00704"></a>00704       <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#1b23c8c9ffb3a6e90ad0e00121ecadbc" title="set particle mass">HEPEVT_Wrapper::set_mass</a>( i, 0 );
<a name="l00705"></a>00705       <a class="code" href="classHepMC_1_1HEPEVT__Wrapper.html#c4cadb49454ee93175278703b1f0c33e" title="set particle production vertex">HEPEVT_Wrapper::set_position</a>( i, 0, 0, 0, 0 );
<a name="l00706"></a>00706     }
<a name="l00707"></a>00707 
<a name="l00708"></a><a class="code" href="classHepMC_1_1IO__HERWIG.html#05ba9f2697ec5543f26e0d64986da860">00708</a>     <span class="keywordtype">int</span> <a class="code" href="classHepMC_1_1IO__HERWIG.html#05ba9f2697ec5543f26e0d64986da860" title="translate particle ID">IO_HERWIG::translate_herwig_to_pdg_id</a>( <span class="keywordtype">int</span> <span class="keywordtype">id</span> )<span class="keyword"> const </span>{
<a name="l00711"></a>00711  
<a name="l00712"></a>00712                                                <span class="comment">// example -9922212</span>
<a name="l00713"></a>00713         <span class="keywordtype">int</span> hwtran = id;                       <span class="comment">//         -9922212</span>
<a name="l00714"></a>00714         <span class="keywordtype">int</span> ida    = abs(<span class="keywordtype">id</span>);                  <span class="comment">//          9922212</span>
<a name="l00715"></a>00715         <span class="keywordtype">int</span> j1     = ida%10;                   <span class="comment">//                2</span>
<a name="l00716"></a>00716         <span class="keywordtype">int</span> i1     = (ida/10)%10;              <span class="comment">//               1</span>
<a name="l00717"></a>00717         <span class="keywordtype">int</span> i2     = (ida/100)%10;             <span class="comment">//              2</span>
<a name="l00718"></a>00718         <span class="keywordtype">int</span> i3     = (ida/1000)%10;            <span class="comment">//             2</span>
<a name="l00719"></a>00719         <span class="comment">//int i4     =(ida/10000)%10;          //            2</span>
<a name="l00720"></a>00720         <span class="comment">//int i5     =(ida/100000)%10;         //           9</span>
<a name="l00721"></a>00721         <span class="comment">//int k99    = (ida/100000)%100;       //          9</span>
<a name="l00722"></a>00722         <span class="keywordtype">int</span> ksusy  = (ida/1000000)%10;         <span class="comment">//         0</span>
<a name="l00723"></a>00723         <span class="comment">//int ku     = (ida/10000000)%10;      //        0</span>
<a name="l00724"></a>00724         <span class="keywordtype">int</span> kqn    = (ida/1000000000)%10;      <span class="comment">//       0</span>
<a name="l00725"></a>00725 
<a name="l00726"></a>00726         <span class="keywordflow">if</span> ( kqn==1 ) {
<a name="l00727"></a>00727             <span class="comment">//  ions not recognized</span>
<a name="l00728"></a>00728             hwtran=0;
<a name="l00729"></a>00729             <span class="keywordflow">if</span> ( m_print_inconsistency_errors ) {
<a name="l00730"></a>00730                 std::cerr &lt;&lt; <span class="stringliteral">"IO_HERWIG::translate_herwig_to_pdg_id "</span> &lt;&lt; <span class="keywordtype">id</span>
<a name="l00731"></a>00731                           &lt;&lt; <span class="stringliteral">"nonallowed ion"</span> &lt;&lt; std::endl;
<a name="l00732"></a>00732             }
<a name="l00733"></a>00733         } 
<a name="l00734"></a>00734         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ida &lt; 100) {
<a name="l00735"></a>00735             <span class="comment">// Higgs, etc.</span>
<a name="l00736"></a>00736             hwtran = m_herwig_to_pdg_id[ida];
<a name="l00737"></a>00737             <span class="keywordflow">if</span> ( <span class="keywordtype">id</span> &lt; 0 ) hwtran *= -1;
<a name="l00738"></a>00738             <span class="comment">// check for illegal antiparticles</span>
<a name="l00739"></a>00739             <span class="keywordflow">if</span> ( <span class="keywordtype">id</span> &lt; 0 ) {
<a name="l00740"></a>00740                 <span class="keywordflow">if</span> ( hwtran&gt;=-99 &amp;&amp; hwtran&lt;=-81) hwtran=0;
<a name="l00741"></a>00741                 <span class="keywordflow">if</span> ( m_no_antiparticles.count(hwtran) ) hwtran=0;
<a name="l00742"></a>00742             }
<a name="l00743"></a>00743         }
<a name="l00744"></a>00744         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ksusy==1 || ksusy==2 ) { ; }
<a name="l00745"></a>00745         <span class="comment">//  SUSY</span>
<a name="l00746"></a>00746         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i1!=0 &amp;&amp; i3!=0 &amp;&amp; j1==2 ) {;}
<a name="l00747"></a>00747         <span class="comment">// spin 1/2 baryons</span>
<a name="l00748"></a>00748         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i1!=0 &amp;&amp; i3!=0 &amp;&amp; j1==4 ) {;}
<a name="l00749"></a>00749         <span class="comment">// spin 3/2 baryons</span>
<a name="l00750"></a>00750         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i1!=0 &amp;&amp; i2!=0 &amp;&amp; i3==0 ) {
<a name="l00751"></a>00751             <span class="comment">// mesons </span>
<a name="l00752"></a>00752             <span class="comment">// check for illegal antiparticles</span>
<a name="l00753"></a>00753             <span class="keywordflow">if</span> ( i1==i2 &amp;&amp; <span class="keywordtype">id</span>&lt;0) hwtran=0;
<a name="l00754"></a>00754         } 
<a name="l00755"></a>00755         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( i2!=0 &amp;&amp; i3!=0 &amp;&amp; i1==0 ) {;}
<a name="l00756"></a>00756         <span class="comment">// diquarks</span>
<a name="l00757"></a>00757         <span class="keywordflow">else</span> {
<a name="l00758"></a>00758             <span class="comment">// undefined</span>
<a name="l00759"></a>00759             hwtran=0;
<a name="l00760"></a>00760         }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762         <span class="comment">// check for illegal anti KS, KL</span>
<a name="l00763"></a>00763         <span class="keywordflow">if</span> ( <span class="keywordtype">id</span>==-130 || <span class="keywordtype">id</span>==-310 ) hwtran=0;
<a name="l00764"></a>00764 
<a name="l00765"></a>00765         <span class="keywordflow">if</span> ( hwtran==0 &amp;&amp; ida!=0 &amp;&amp; m_print_inconsistency_errors ) {
<a name="l00766"></a>00766             std::cerr 
<a name="l00767"></a>00767                 &lt;&lt; <span class="stringliteral">"IO_HERWIG::translate_herwig_to_pdg_id HERWIG particle "</span> 
<a name="l00768"></a>00768                 &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">" translates to zero."</span> &lt;&lt; std::endl;
<a name="l00769"></a>00769         }
<a name="l00770"></a>00770 
<a name="l00771"></a>00771         <span class="keywordflow">return</span> hwtran;
<a name="l00772"></a>00772     }
<a name="l00773"></a>00773 
<a name="l00774"></a>00774 } <span class="comment">// HepMC</span>
<a name="l00775"></a>00775 
<a name="l00776"></a>00776 
<a name="l00777"></a>00777 
<a name="l00778"></a>00778 
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Tue Oct 23 17:05:35 2007 for HepMC by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-3 </small></address>
</body>
</html>
